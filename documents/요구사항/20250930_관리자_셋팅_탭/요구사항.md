# 관리자 설정 탭 요구사항 (Phase 1 - MVP)

## 개요

관리자가 블로그 전반적인 설정을 관리할 수 있는 설정 페이지를 구현합니다.
Phase 1에서는 읽기 전용 프로필 정보, 블로그 기본 정보, 포스트 기본 설정의 필수 기능만 포함합니다.

---

## 1. 프로필 정보 표시 (읽기 전용)

### 1.1 목적
- 현재 로그인한 관리자의 정보를 한눈에 확인
- Google OAuth로 가져온 정보를 표시하므로 수정 불가 (읽기 전용)
- 보안 확인: 올바른 계정으로 접속했는지 확인

### 1.2 표시할 정보
| 항목 | 데이터 출처 | 설명 |
|------|------------|------|
| **프로필 이미지** | `session.user.image` | Google 계정의 프로필 사진 (원형 표시) |
| **이름** | `session.user.name` | Google 계정의 이름 |
| **이메일** | `session.user.email` | Google 계정의 이메일 주소 |
| **역할** | `session.user.role` | ADMIN 또는 USER (배지 형태로 표시) |

### 1.3 UI 구성
```
┌─────────────────────────────────────────┐
│  👤 프로필 정보                           │
├─────────────────────────────────────────┤
│                                         │
│     [프로필 이미지]                       │
│                                         │
│     이름         미온                    │
│     이메일       whddbs311@gmail.com    │
│     역할         [ADMIN 배지]            │
│                                         │
│  ℹ️  Google 계정 정보는 Google에서만      │
│     변경할 수 있어요.                     │
└─────────────────────────────────────────┘
```

### 1.4 기술 구현
- **데이터 소스**: NextAuth의 `getServerSession()`으로 세션 정보 조회
- **컴포넌트**: Server Component로 구현 (세션 정보는 서버에서만 접근)
- **스타일**: 기존 admin 페이지와 동일한 slate 색상 테마 사용

---

## 2. 블로그 기본 정보

### 2.1 목적
- 블로그 전체에서 사용되는 기본 메타데이터 관리
- SEO 및 브랜딩을 위한 핵심 정보 설정

### 2.2 설정 항목

#### 2.2.1 사이트 제목 (필수)
- **필드명**: `siteTitle`
- **타입**: `string`
- **최대 길이**: 60자
- **기본값**: "Mion's Blog"
- **사용처**:
  - `<title>` 태그
  - Open Graph `og:site_name`
  - 헤더 로고 텍스트

#### 2.2.2 사이트 설명 (필수)
- **필드명**: `siteDescription`
- **타입**: `string`
- **최대 길이**: 160자
- **기본값**: "개발과 기술에 관한 이야기를 나눕니다."
- **사용처**:
  - `<meta name="description">`
  - Open Graph `og:description`
  - 홈페이지 서브타이틀

#### 2.2.3 사이트 URL (필수)
- **필드명**: `siteUrl`
- **타입**: `string` (URL 형식)
- **기본값**: `process.env.NEXTAUTH_URL` 또는 "http://localhost:3000"
- **검증**: URL 형식 체크 (`https://` 또는 `http://` 시작)
- **사용처**:
  - Canonical URL 생성
  - Open Graph `og:url`
  - RSS Feed 링크

### 2.3 UI 구성
```
┌─────────────────────────────────────────┐
│  🌐 블로그 기본 정보                      │
├─────────────────────────────────────────┤
│                                         │
│  사이트 제목 *                           │
│  [Mion's Blog                        ]  │
│  → 브라우저 탭과 검색 결과에 표시돼요     │
│                                         │
│  사이트 설명 *                           │
│  [개발과 기술에 관한 이야기를...      ]  │
│  → 검색 엔진과 SNS 공유 시 표시돼요      │
│                                         │
│  사이트 URL *                            │
│  [https://mionblog.com               ]  │
│  → 정식 URL을 입력해주세요               │
│                                         │
│  [ 취소 ]  [ 저장하기 ]                 │
└─────────────────────────────────────────┘
```

### 2.4 기술 구현

#### 2.4.1 데이터베이스 스키마
```typescript
// packages/database/src/schema/settings.ts
export const blogSettings = pgTable('blog_settings', {
  id: uuid('id').primaryKey().defaultRandom(),
  key: varchar('key', { length: 100 }).notNull().unique(),
  value: text('value').notNull(),
  description: text('description'),
  updatedAt: timestamp('updated_at').notNull().defaultNow(),
  updatedBy: uuid('updated_by').references(() => users.id),
})
```

#### 2.4.2 저장 방식
- Key-Value 구조로 유연하게 관리
- 예시 레코드:
  ```
  { key: 'site_title', value: 'Mion's Blog' }
  { key: 'site_description', value: '개발과 기술에...' }
  { key: 'site_url', value: 'https://mionblog.com' }
  ```

#### 2.4.3 API 엔드포인트
- `GET /api/admin/settings` - 전체 설정 조회
- `PATCH /api/admin/settings` - 설정 일괄 업데이트

#### 2.4.4 백엔드 구조 (Nest.js)
```
apps/blog-api/src/
├── settings/
│   ├── settings.controller.ts    # API 엔드포인트
│   ├── settings.service.ts       # 비즈니스 로직
│   ├── dto/
│   │   ├── update-settings.dto.ts
│   │   └── settings-response.dto.ts
│   └── settings.module.ts
```

#### 2.4.5 프론트엔드 구조 (Next.js)
```
apps/blog-web/
├── app/admin/settings/page.tsx           # 설정 페이지
├── components/admin/settings/
│   ├── blog-info-form.tsx                # 블로그 정보 폼
│   └── profile-card.tsx                  # 프로필 카드
├── lib/admin/
│   └── settings-actions.ts               # Server Actions
```

---

## 3. 포스트 기본 설정

### 3.1 목적
- 포스트 목록 페이지에서 한 번에 표시할 게시물 개수 설정
- 페이지네이션 동작 제어

### 3.2 설정 항목

#### 3.2.1 페이지당 포스트 수
- **필드명**: `postsPerPage`
- **타입**: `number`
- **최솟값**: 5
- **최댓값**: 50
- **기본값**: 10
- **단위**: 개
- **사용처**:
  - 메인 페이지 포스트 목록
  - 카테고리별 포스트 목록
  - 태그별 포스트 목록
  - 검색 결과 페이지

### 3.3 UI 구성
```
┌─────────────────────────────────────────┐
│  📝 포스트 기본 설정                      │
├─────────────────────────────────────────┤
│                                         │
│  페이지당 포스트 수                       │
│  [10                      ] 개          │
│  ━━━━●━━━━━━━━━━━━━━━━━━━━━            │
│  5                                  50  │
│                                         │
│  → 목록 페이지에서 한 번에 보여줄         │
│     포스트 개수를 설정해요                │
│                                         │
│  [ 취소 ]  [ 저장하기 ]                 │
└─────────────────────────────────────────┘
```

### 3.4 기술 구현

#### 3.4.1 데이터 저장
```
{ key: 'posts_per_page', value: '10' }
```

#### 3.4.2 적용 위치
- **Server Component에서 사용**:
  ```typescript
  const settings = await getSettings()
  const limit = Number(settings.posts_per_page) || 10

  const posts = await apiClient.posts.getPosts({
    page: 1,
    limit,
    order: 'desc',
    sort: 'createdAt'
  })
  ```

---

## 4. 페이지 레이아웃

### 4.1 전체 구조
```
┌──────────────────────────────────────────────┐
│  [← 관리자 콘솔로 돌아가기]                    │
│                                              │
│  설정                                         │
│  블로그 설정을 관리하세요.                     │
├──────────────────────────────────────────────┤
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │  👤 프로필 정보                         │ │
│  │  (읽기 전용)                            │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │  🌐 블로그 기본 정보                    │ │
│  │  (편집 가능)                            │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │  📝 포스트 기본 설정                    │ │
│  │  (편집 가능)                            │ │
│  └────────────────────────────────────────┘ │
│                                              │
└──────────────────────────────────────────────┘
```

### 4.2 스타일 가이드
- **섹션 간격**: `space-y-6`
- **카드 스타일**: `rounded-xl border border-slate-800 bg-slate-900/40 p-6`
- **제목 스타일**: `text-lg font-semibold text-slate-50`
- **설명 스타일**: `text-sm text-slate-500`
- **입력 필드**: `rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-slate-100`
- **버튼**: 기존 admin 페이지와 동일한 emerald 계열 사용

---

## 5. 폼 동작 및 검증

### 5.1 클라이언트 검증
- **사이트 제목**: 1자 이상 60자 이하
- **사이트 설명**: 1자 이상 160자 이하
- **사이트 URL**:
  - URL 형식 체크 (`https://` 또는 `http://` 시작)
  - 필수 입력
- **포스트 수**: 5 이상 50 이하의 정수

### 5.2 서버 검증
- DTO에서 `class-validator` 사용
  ```typescript
  @IsString()
  @Length(1, 60)
  siteTitle: string

  @IsString()
  @Length(1, 160)
  siteDescription: string

  @IsUrl({ protocols: ['http', 'https'] })
  siteUrl: string

  @IsInt()
  @Min(5)
  @Max(50)
  postsPerPage: number
  ```

### 5.3 저장 성공/실패 처리
- **성공 시**:
  - 상단에 성공 배너 표시: "설정이 저장되었어요."
  - 폼 필드는 최신 값 유지
  - URL에 `?status=updated` 파라미터 추가

- **실패 시**:
  - 폼 위에 오류 메시지 표시
  - 입력한 값 유지 (초기화하지 않음)
  - 오류가 발생한 필드에 빨간색 테두리

---

## 6. 보안 및 권한

### 6.1 접근 권한
- **필수 조건**: ADMIN 역할만 접근 가능
- **미들웨어**: `RolesGuard`로 보호
- **인증**: JWT Bearer 토큰 필수

### 6.2 데이터 보호
- 설정 변경 시 `updatedBy` 필드에 관리자 ID 기록
- 변경 이력 추적 가능하도록 `updatedAt` 자동 갱신

---

## 7. 초기 데이터 (Seed)

### 7.1 기본 설정값
```typescript
const defaultSettings = [
  {
    key: 'site_title',
    value: "Mion's Blog",
    description: '블로그 사이트 제목'
  },
  {
    key: 'site_description',
    value: '개발과 기술에 관한 이야기를 나눕니다.',
    description: '블로그 사이트 설명'
  },
  {
    key: 'site_url',
    value: process.env.NEXTAUTH_URL || 'http://localhost:3000',
    description: '블로그 사이트 URL'
  },
  {
    key: 'posts_per_page',
    value: '10',
    description: '페이지당 포스트 수'
  }
]
```

### 7.2 Seed 실행
```bash
pnpm --filter=@repo/database db:seed
```

---

## 8. 개발 순서

### 8.1 백엔드 (Nest.js)
1. ✅ `blog_settings` 테이블 스키마 생성
2. ✅ Drizzle 마이그레이션 실행
3. ✅ Seed 데이터 추가
4. ✅ Settings Module, Service, Controller 구현
5. ✅ DTO 정의 (UpdateSettingsDto, SettingsResponseDto)
6. ✅ API 엔드포인트 테스트 (Swagger)

### 8.2 프론트엔드 (Next.js)
1. ✅ `/admin/settings/page.tsx` 페이지 생성
2. ✅ 프로필 정보 카드 컴포넌트 구현
3. ✅ 블로그 기본 정보 폼 컴포넌트 구현
4. ✅ 포스트 기본 설정 폼 컴포넌트 구현
5. ✅ Server Actions 구현 (`settings-actions.ts`)
6. ✅ 폼 검증 및 에러 처리
7. ✅ 성공/실패 배너 구현

---

## 9. 테스트 체크리스트

### 9.1 기능 테스트
- [ ] 프로필 정보가 올바르게 표시되는가?
- [ ] 블로그 기본 정보를 수정하고 저장할 수 있는가?
- [ ] 포스트 수 설정을 변경하고 저장할 수 있는가?
- [ ] 잘못된 값 입력 시 검증 오류가 표시되는가?
- [ ] 저장 성공 시 성공 메시지가 표시되는가?
- [ ] 저장 실패 시 오류 메시지가 표시되는가?

### 9.2 보안 테스트
- [ ] 비로그인 상태에서 접근 시 로그인 페이지로 리다이렉트되는가?
- [ ] USER 역할로 접근 시 403 오류가 발생하는가?
- [ ] 설정 변경 시 updatedBy가 올바르게 기록되는가?

### 9.3 UI/UX 테스트
- [ ] 모바일 화면에서도 레이아웃이 깨지지 않는가?
- [ ] 입력 필드에 placeholder가 적절한가?
- [ ] 버튼 클릭 시 로딩 상태가 표시되는가?
- [ ] 다크 테마 색상이 일관성 있게 적용되는가?

---

## 10. 향후 확장 계획 (Phase 2, 3)

### Phase 2
- SEO 설정 (Google Analytics, Search Console)
- 소셜 미디어 링크
- 세션 정보 및 로그인 이력

### Phase 3
- 테마 커스터마이징 (색상, 폰트)
- API 토큰 관리
- 데이터 백업 및 복원